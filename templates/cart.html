{% extends "base.html" %}
{% block content %}
<h2>Cart</h2>
<div class="card">
  {% if not items %}
    Empty. <a class="btn" href="{{ url_for('shop') }}">Go to shop</a>
  {% else %}
    <form method="post" style="margin-bottom:10px">
      <label>Postcode:</label>
      <input name="postcode" value="{{ postcode }}" placeholder="e.g. 4000" />
      <label><input type="checkbox" name="want_install"> Apply install</label>
      <label><input type="checkbox" name="want_callout"> Apply call‑out</label>
      <button class="btn" type="submit">Update</button>
      <p class="muted" style="margin-top:6px">Local eligible: {{ 'Yes' if local_ok else 'No (Brisbane/Gold Coast only)' }}</p>
    </form>

    <ul>
      {% for x in items %}
        <li>
          <b>{{ x.unit.Brand }} {{ x.unit["Model (Series/Gen)"] }}</b> — {{ x.unit.PriceAUD }} AUD
          <div class="muted">
            {% set opt = x.opt %}
            {% if opt.custom_sound %}Custom sound: Yes · {% endif %}
            {% if opt.premium_brand %}Premium: {{ opt.premium_brand }} · {% endif %}
            {% if opt.extra_mic %}External mic · {% endif %}
            {% if opt.keep_sw_controls %}SWC retained · {% endif %}
            {% if opt.postcode %}Postcode: {{ opt.postcode }}{% endif %}
            {% if opt.want_install %} · Install{% endif %}
            {% if opt.want_callout %} · Call‑out{% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>

    <p>Subtotal: {{ sub_units }} AUD</p>
    <p>Install: {{ install_total }} AUD &nbsp; Call‑out: {{ callout_total }} AUD &nbsp; Shipping: {{ shipping }} AUD</p>
    <h3>Total: {{ grand }} AUD ({{ g.ccy }})</h3>
    <a class="btn" href="{{ url_for('checkout') }}">Checkout</a>
  {% endif %}
</div>
{% endblock %}
